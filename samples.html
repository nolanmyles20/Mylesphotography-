<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sample Images | Myles Photography LLC</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/png" href="assets/favicon.png" />

  <!-- Minimal lightbox + gallery loading styles -->
  <style>
    /* Lightbox */
    .lightbox {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.8);
      display: none; place-items: center;
      z-index: 9999; padding: 20px;
    }
    .lightbox.open { display: grid; }
    .lightbox img {
      max-width: 90vw; max-height: 85vh; border-radius: 12px; display: block;
    }
    .lightbox-cap {
      color: #ccc; margin-top: 10px; text-align: center; max-width: 90vw;
    }
    .lightbox-close {
      position: absolute; top: 14px; right: 18px;
      background: #111; color: #fff; border: 1px solid #333;
      border-radius: 10px; font-size: 20px; line-height: 1;
      padding: 8px 12px; cursor: pointer;
    }

    /* Spinner on each image while loading */
    .gallery figure {
      position: relative; /* needed for spinner positioning */
    }

    .gallery figure.is-loading::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 34px;
      height: 34px;
      margin: -17px 0 0 -17px;
      border-radius: 50%;
      border: 3px solid rgba(255,255,255,0.25);
      border-top-color: #ffffff;
      animation: gallerySpin .8s linear infinite;
      pointer-events: none;
      z-index: 2;
    }

    @keyframes gallerySpin {
      to { transform: rotate(360deg); }
    }

    /* Optional: faint placeholder background while loading */
    .gallery figure.is-loading img {
      opacity: 0.2;
      transition: opacity 0.25s ease;
    }
    .gallery figure img.loaded {
      opacity: 1;
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="index.html">
        <img src="assets/logo.png" alt="Myles Photography LLC logo" class="logo" />
        <span>Myles Photography LLC</span>
      </a>
      <div class="services-tag">
        <span class="drone-wrap fly-in" aria-hidden="true">
          <img src="assets/drone.png" alt="Drone icon" class="services-drone">
        </span>
        <span>Drone Services</span>
      </div>
      <nav class="navlinks">
        <a href="samples.html" class="btn">Sample Images</a>
        <a href="virtual-tours.html" class="btn">Virtual Tours</a>
        <a href="about.html" class="btn">About Us</a>
        <a href="locations.html" class="btn">Locations</a>
        <a href="payment.html" class="btn">Payment</a>
        <a href="contact.html" class="btn">Contact</a>
      </nav>
      <a class="faa-badge" href="about.html#faa-cert" aria-label="FAA Certified Drone Pilot">
        <img src="assets/faa-badge.png" alt="FAA Certified Drone Pilot badge">
      </a>
    </div>
  </header>

  <main class="page">
    <h1>Sample Work</h1>
    <p>We can do anything from premium waterfront property to commercial buildings downtown to even the middle of nowhere.</p>

    <!-- ðŸŽ¥ Featured Autoplay Video -->
    <div class="video-grid" style="margin-top:2rem;">
      <iframe
        src="https://www.youtube.com/embed/iVyg4wXB2MM?autoplay=1&mute=1&loop=1&playlist=iVyg4wXB2MM"
        title="Featured Aerial Reel"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen>
      </iframe>
    </div>

    <!-- ðŸ–¼ï¸ Image Gallery -->
    <div id="gallery" class="gallery" aria-live="polite"></div>

    <!-- ðŸŽ¬ Secondary Video Section -->
    <h2 style="margin-top:3rem; text-align:center;">More Sample Videos</h2>
    <div class="video-grid">
      <iframe
        width="560"
        height="315"
        src="https://www.youtube.com/embed/INyz0gTMGc4?si=TZ5mK2RFo5qhgVjJI"
        title="YouTube video player"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen>
      </iframe>
    </div>
    <div class="video-grid">
      <iframe
        width="560"
        height="315"
        src="https://www.youtube.com/embed/_XxktVZ8k-M?si=YgVtJkvmgi_fO_0F"
        title="YouTube video player"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen>
      </iframe>
    </div>
  </main>

  <!-- ðŸ”Ž Lightbox overlay -->
  <div id="lightbox" class="lightbox" aria-hidden="true">
    <button class="lightbox-close" aria-label="Close">Ã—</button>
    <img id="lightbox-img" alt="" />
    <div id="lightbox-cap" class="lightbox-cap"></div>
  </div>

  <footer>
    <p>Â© 2025 Myles Photography LLC â€¢ <a href="mailto:nolanmyles@icloud.com">nolanmyles@icloud.com</a></p>
  </footer>

  <script>
    // Build gallery from manifest with lazy-loading & per-image spinner
    async function loadGallery() {
      const container = document.getElementById('gallery');

      // Create IntersectionObserver for lazy-loading
      const observer = 'IntersectionObserver' in window
        ? new IntersectionObserver((entries, obs) => {
            entries.forEach(entry => {
              if (!entry.isIntersecting) return;
              const img = entry.target;
              const fig = img.closest('figure');
              const src = img.dataset.src;
              if (src && !img.src) {
                img.src = src;
              }
              obs.unobserve(img);
            });
          }, { rootMargin: '200px 0px' })
        : null;

      try {
        const res = await fetch('assets/samples/manifest.json');
        if (!res.ok) throw new Error('manifest not found');
        const data = await res.json();
        if (!data.images || !Array.isArray(data.images)) throw new Error('invalid manifest');

        data.images.forEach(item => {
          const fig = document.createElement('figure');
          fig.classList.add('is-loading');   // show spinner

          const link = document.createElement('a');
          const img = document.createElement('img');
          const cap = document.createElement('figcaption');

          const fullSrc = 'assets/samples/' + item.src;

          link.href = fullSrc;
          link.className = 'lb';

          // lazy-load: store real src in data-src, let IO set actual src
          img.dataset.src = fullSrc;
          img.alt = item.caption || 'Sample image';

          // when the image actually loads, remove spinner and fade in
          img.addEventListener('load', () => {
            fig.classList.remove('is-loading');
            img.classList.add('loaded');
          });

          img.addEventListener('error', () => {
            fig.classList.remove('is-loading');
            img.classList.add('loaded');
          });

          cap.textContent = item.caption || '';

          link.appendChild(img);
          fig.appendChild(link);
          fig.appendChild(cap);
          container.appendChild(fig);

          // Start observing for lazy-load
          if (observer) {
            observer.observe(img);
          } else {
            // Fallback: no IntersectionObserver, just load immediately
            img.src = fullSrc;
          }
        });

        // Lightbox behavior
        const lb = document.getElementById('lightbox');
        const lbImg = document.getElementById('lightbox-img');
        const lbCap = document.getElementById('lightbox-cap');
        const closeBtn = document.querySelector('.lightbox-close');

        container.addEventListener('click', (e) => {
          const a = e.target.closest('a.lb');
          if (!a) return;
          e.preventDefault();
          lbImg.src = a.href;
          lbCap.textContent = a.parentElement.querySelector('figcaption')?.textContent || '';
          lb.classList.add('open');
          lb.setAttribute('aria-hidden', 'false');
          document.body.style.overflow = 'hidden';
        });

        closeBtn.addEventListener('click', () => {
          lb.classList.remove('open');
          lb.setAttribute('aria-hidden', 'true');
          lbImg.src = '';
          document.body.style.overflow = '';
        });

        lb.addEventListener('click', (e) => {
          if (e.target === lb) closeBtn.click();
        });

      } catch (e) {
        console.error(e);
        container.innerHTML =
          '<p style="color:#bbb">No manifest found. Create <code>assets/samples/manifest.json</code> to list your images.</p>';
      }
    }

    loadGallery();
  </script>
</body>
</html>
